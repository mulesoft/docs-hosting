= Managing App Schedules

*Last update* 22-Feb-22

You can use Runtime Manager to view and control the Scheduler components within the flows in your deployed applications, all without changing the running application.

On the *Schedules* tab, you can:

* View the schedules in your running application.
* Change the schedules in your application at runtime without redeploying.
* Run the scheduled job immediately, without changing the schedule.
* Disable or enable the schedule for a flow.

You configure Scheduler component types as either _fixed frequency_ to trigger at a regular interval or _cron_ to trigger at a date and time based on a specified cron expression.

[IMPORTANT]
To change a schedule type (between fixed frequency and cron or vice versa),
you must update and redeploy the app.
You can't change the schedule type on a deployed application.

The CloudHub 2.0 scheduler reads the job configuration every time it runs.
When you update the scheduler configuration, the change takes effect the next time the scheduler runs.

Schedules are based in the timezone of the geographic region where you deploy the app.

For multi-replica apps, CloudHub 2.0 runs scheduled jobs on all replicas.
If you run the scheduled job immediately by clicking *Run*, the scheduler runs on a single replica.

CloudHub 2.0 distributes multiple concurrent schedulers across replicas.

[NOTE]
You cannot manage CloudHub 2.0 schedules using scripts.
Use the *Schedules* tab or the CloudHub 2.0 API to manage CloudHub 2.0 schedules.

[[schedule-timing]]
== Schedule Trigger Timing

*Do these still apply with CloudHub 2.0?*

When designing the schedule, consider the following:

* Plan for high availability during network failures, infrastructure restarts due to hardware issues or scheduled maintenance, and security updates.
+
During service updates or security patching, CloudHub 2.0 waits two minutes for existing schedules to complete.
After two minutes, CloudHub 2.0 retriggers any incomplete schedules.
+
To avoid retriggers with long-running schedules, make sure that the app executes the flow idempotently.
* If a scheduled job is not triggered because the application is not running,
CloudHub 2.0 triggers the job as soon as the app restarts.
* When a Mule 4.x app uses a schedule to trigger a flow with subflow, the scheduler waits until both main flow and subflow complete before scheduling the next run.

== Prerequisites

To use the scheduling feature in Runtime Manager, deploy an application that includes one or more Scheduler elements:

image::ch2-scheduler-studio.png[Scheduler component in the Anypoint Studio canvas]

You can download this example app from Exchange.
For information, see xref:ch2-download-test-app.adoc[].

After you deploy the app, you can manage the schedule in Runtime Manager.
The app doesn't need to be running.

== View and Manage Application Schedules in Runtime Manager

After deploying an app to CloudHub 2.0, view and manage the Scheduler elements in Runtime Manager:

// SELECT RTM APPS SHARED
include::partial$select-private-space.adoc[tag=selectAppsPage]
include::partial$select-private-space.adoc[tag=clickAppName]
include::partial$select-private-space.adoc[tag=clickSchedules]
+
Runtime Manager lists the Scheduler elements in the order they appear in your app:
+
<update screenshot>
+
image::ch2-scheduler-rtm.png[Schedules page showing the Last Run column, frequency link, and the Logs option]
+
.. The *Last Run* column shows the date and time each Scheduler element last ran.
.. The frequency link in the *Schedule* column shows the schedule for the element.
.. You can click *Logs* in the left navigation menu to see more information about when the jobs started and ended scheduled runs.
. Click the frequency link for an element to open the schedule editor.
+
The schedule editor you see depends on the schedule type:
+
* <<change-fixed-frequency-schedule,Fixed frequency>>
* <<change-cron-schedule,Cron>>
. In the schedule editor, change the schedule or deselect *Enabled* to disable the schedule.

[[change-fixed-frequency-schedule]]
=== Change a Fixed Frequency Schedule

// SELECT RTM APPS SHARED
include::partial$select-private-space.adoc[tag=selectAppsPage]
include::partial$select-private-space.adoc[tag=clickAppName]
include::partial$select-private-space.adoc[tag=clickSchedules]
+
The frequency link in the *Schedule* column shows the schedule for the element.
+
<update screenshot>
+
image::ch2-scheduler-rtm.png[Schedules page showing a fixed frequency schedule type]
. Click the frequency link for an element to open the schedule editor.
. In the schedule editor, change the schedule or deselect *Enabled* to disable the schedule.
+
<update screenshot>
+
image::ch2-scheduler-frequency.png[Change the frequency in the schedule editor]
The value for the frequency can be between 1 and 100 seconds.
The minimum recommended frequency between calls is 10 seconds.
. Click *Update* to save changed settings or click *Cancel* to exit without saving.


[[change-cron-schedule]]
=== Change a Cron Schedule

With cron expressions, you can create more complex schedule frequencies,
such as every 5 minutes between 9:00 am and 10:00 am on Fridays.

To change the frequency of a cron schedule type:

// SELECT RTM APPS SHARED
include::partial$select-private-space.adoc[tag=selectAppsPage]
include::partial$select-private-space.adoc[tag=clickAppName]
include::partial$select-private-space.adoc[tag=clickSchedules]
+
The frequency link in the *Schedule* column shows the schedule for the element.
+
<update screenshot>
+
image::ch2-scheduler-rtm.png[Schedules page showing a cron schedule type]
. Click the frequency link for an element to open the schedule editor.
. In the schedule editor, click *Quick Reference* to expand or collapse the table that lists required fields and allowed values:
+
<update screenshot>
+
image::ch2-scheduler-cron.png[Quick Reference toggle and the more link on the cron type page]
+
The cron expression in this example sets the schedule to every 10 seconds.
+
For information about building cron triggers:
+
.. Click *more* to view the http://www.quartz-scheduler.org/documentation[Quartz documentation^] (link out from Beta docs). 
.. Select a version, click *Documentation > User's Guide > Tutorial*, and then click the *CronTrigger* lesson.
. Click *Update* to save changed cron settings or click *Cancel* to exit without saving.

[[run-immediately]]
== Run a Scheduled Job Immediately

If a job runs nightly but you want to debug it now, you can trigger the job
while it's running without updating the schedule in your application.

[NOTE]
If you run the scheduled job immediately, the scheduler runs on a single replica
even for multi-replica apps.

To override the schedule and run the job immediately:

// SELECT RTM APPS SHARED
include::partial$select-private-space.adoc[tag=selectAppsPage]
include::partial$select-private-space.adoc[tag=clickAppName]
include::partial$select-private-space.adoc[tag=clickSchedules]
. Select the elements to manage and then click *Run*.

[[disable-enable-scheduler]]
== Disable or Enable a Scheduler Element 

You might want to disable a scheduled job if an application you are connecting
to is undergoing maintenance and then reenable it after maintenance is complete.

CloudHub 2.0 does not run the scheduled job until you reenable the Scheduler.

To disable the Scheduler element:

// SELECT RTM APPS SHARED
include::partial$select-private-space.adoc[tag=selectAppsPage]
include::partial$select-private-space.adoc[tag=clickAppName]
include::partial$select-private-space.adoc[tag=clickSchedules]
. Select the elements to manage and then click *Disable*.
+
You can also disable or enable the schedule by deselecting or 
selecting *Enabled* in the schedule editor.
+
<update screenshot>
+
image::ch2-scheduler-enable.png[Enabled toggle in the schedule editor]


== See Also

* xref:ch2-deploy.adoc[]
* https://docs.mulesoft.com/mule-runtime/4.4/scheduler-concept[Scheduler Endpoint (Trigger)^] (link out from Beta docs)
* http://www.quartz-scheduler.org/documentation[Quartz documentation^] (link out from Beta docs)
* https://anypoint.mulesoft.com/exchange/?view=grid&type=example&search=&organizationId=68ef9520-24e9-4cf2-b2f5-620025690913[Example Assets provided by MuleSoft^] (link out from Beta docs)
* _Link to the API doc for updating schedulers_

