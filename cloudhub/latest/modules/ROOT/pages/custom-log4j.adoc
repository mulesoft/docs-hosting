= Integrate with Your Logging System Using Log4j
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:keywords: cloudhub, logging, enhanced log management

image:logo-cloud-active.png[xref="deployment-strategies.adoc#cloudhub-deployments", title="CloudHub"]
image:logo-hybrid-disabled.png[xref="deployment-strategies.adoc#hybrid-deployments", title="Hybrid"]
image:logo-server-disabled.png[xref="deployment-strategies.adoc#anypoint-platform-pce-deployments", title="Anypoint Platform PCE"]
image:logo-rtf-disabled.png[xref="deployment-strategies.adoc#anypoint-runtime-fabric-deployments", title="Runtime Fabric"]

You can integrate your CloudHub application with your logging system by using the Log4j configuration.

== Requirements and Restrictions

* MuleSoft Support doesn't provide assistance for implementing custom logging configurations or resolving issues caused by custom logging configurations.
* MuleSoft is not responsible for issues arising from misconfiguration of your Log4j appender, including these or other issues:
** Lost logging data
** Performance degradation
** Running out of disk space
* Do not use synchronous log appenders.
* Do not use file appenders. (FileAppender, RollingFileAppender, RandomAccessFileAppender ...etc)
+
You can use only asynchronous log appenders.
* When you use custom Log4j configurations:
** Both Mule Runtime and application logs will remain available in Runtime Manager.


== Create Your Log4j Configuration: Splunk as an example

You can use any Log4j appender. For information about configuring `log4j2.xml`, see the
https://logging.apache.org/log4j/2.x/manual/configuration.html#ConfigurationSyntax[Log4j Configuration Syntax].

For logs to both be viewable in CloudHub , and flow to your logging system (Splunk), configure the SplunkHttp appender.

To enable the Log4j appender, update the `log4j2.xml` configuration file with your logger settings and include the Log4j appenders `SplunkHttp`.
In Anypoint Studio, the `log4j2.xml` file is located in the `src/main/resources` directory.

[INFO]
AnypointMonitoringFileAppender will be automatically configured when the application is deployed to Clodhub. There is no need to configure it in anyway in `log4j2.xml`.

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>
<Configuration status="INFO" name="cloudhub" packages="com.mulesoft.ch.logging.appender">
    <Appenders>
    	<Console name="CONSOLE" target="SYSTEM_OUT">
            <PatternLayout pattern="[%d{MM-dd HH:mm:ss}] %-5p %c{1} [%t]: %m%n"/>
        </Console>
        <SplunkHttp name="SPLUNK" 
        	source="${env:APP_NAME}"
        	host="${env:POD_NAME}"
        	sourceType="mule-app"
            url="${sys:splunk.host}"
            token="${sys:splunk.token}"
            index="main">
            <PatternLayout pattern="[%d{MM-dd HH:mm:ss}] %-5p %c{1} [%t]: %m%n" />
        </SplunkHttp>
    </Appenders>
    <Loggers>
        <AsyncRoot level="INFO">
            <AppenderRef ref="CONSOLE"/>
            <AppenderRef ref="SPLUNK"/>
        </AsyncRoot>
    </Loggers>
</Configuration>
----

You need to ensure the Splunk dependency is added. The latest version is available on GitHub(https://github.com/splunk/splunk-library-javalogging/tags)

[source,xml,linenums]
----
<dependency> 
   <groupId>com.splunk.logging</groupId> 
   <artifactId>splunk-library-javalogging</artifactId> 
   <version>x.x.x</version> 
</dependency>   
*********
******************
<repository> 
   <id>splunk-artifactory</id> 
   <name>Splunk Releases</name> 
   <url>https://splunk.jfrog.io/splunk/ext-releases-local</url>; 
</repository>
----

After your application starts, logs should start flowing to your custom Log4j appender and are viewable on your target logging system.

== See Also

* https://help.mulesoft.com/s/global-search/%40uri#q=log4j&t=SalesforceArticle&f:@sfdcproduct=[CloudHub Log4j Knowledge Articles]
